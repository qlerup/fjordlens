{% extends "base.html" %}
{% block title %}2FA Login · FjordLens{% endblock %}
{% block body %}
  <div class="center-screen">
    <form id="verifyForm" class="login-card small" method="post">
      <h2 style="margin:0 0 10px;">Indtast 2FA-kode</h2>
      {% if error %}<div class="err">{{ error }}</div>{% endif %}
      <div class="form-row">
        <label for="code">6-cifret kode</label>
        <input id="code" name="code" type="text" required inputmode="numeric" autocomplete="one-time-code" pattern="\d{6}" maxlength="6" placeholder="••••••">
      </div>
      <div class="actions">
        <a class="mini-link" href="/login">Tilbage</a>
        <button class="btn primary" type="submit">Bekræft</button>
      </div>
    </form>
  </div>
{% endblock %}
{% block scripts %}
  <script>
    (function(){
      const input = document.getElementById('code');
      const form = document.getElementById('verifyForm');
      if (!input || !form) return;
      input.addEventListener('input', () => {
        const v = (input.value || '').replace(/\D/g, '').slice(0,6);
        if (v !== input.value) input.value = v;
        if (v.length === 6) {
          try { form.requestSubmit ? form.requestSubmit() : form.submit(); } catch(e) { form.submit(); }
        }
      });
      input.focus();
    })();
  </script>
{% endblock %}
